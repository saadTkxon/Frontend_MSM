<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- FAVICON LINKS -->
    <link rel="icon" type="image/png" href="/assets/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="./assets/favicon/favicon.svg" />
    <link rel="shortcut icon" href="./assets/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="M$M Kosmetika" />
    <link rel="manifest" href="./assets/favicon/site.webmanifest" />
    <!-- CSS FILES LINKS -->
    <!-- <link rel="stylesheet" href="/msm_kosmetika_fin/css/global/global.css">
    <link rel="stylesheet" href="/msm_kosmetika_fin/css/global/fonts.css">
    <link rel="stylesheet" href="/msm_kosmetika_fin/css/global/root.css">
    <link rel="stylesheet" href="/msm_kosmetika_fin/css/global/loading.css">
    <link rel="stylesheet" href="/msm_kosmetika_fin/css/global/alert.css">
    <link rel="stylesheet" href="/msm_kosmetika_fin/css/account/setNewPassword.css"> -->

    <!-- taimoor correction path -->

    <link rel="stylesheet" href="/css/global/global.css">
    <link rel="stylesheet" href="/css/global/fonts.css">
    <link rel="stylesheet" href="/css/global/root.css">
    <link rel="stylesheet" href="/css/global/loading.css">
    <link rel="stylesheet" href="/css/global/alert.css">
    <link rel="stylesheet" href="/css/account/setNewPassword.css">




    <!-- <script src="/msm_kosmetika_fin/js/apiscalling/auth.js"></script> -->
    <!-- WEBSITE TITLE -->
    <title>M$M - Set New Password</title>
</head>

<body onload="hidePagePreloading()">

    <div class="pagePreloading">
        <div class="loader">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
        </div>
    </div>

    <div class="loading" style="display: none;">
        <div class="loader">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
        </div>
    </div>

    <div class="logoArea">
        <a href=""><img src="/assets/branding/logoOne.webp" alt=""></a>
    </div>

    <div class="formScreen">
        <div class="formArea">

            <div class="accountArea">

                <form action="" class="newPasswordForm" id="newPasswordForm">
                    <h1>Set new password</h1>
                    <p>Enter a password and remember it for future access.</p>
                    <div class="inputsArea">
                        <div class="oneInput">
                            <label for="newPassword">Password <span>*</span></label>
                            <input type="text" placeholder="Password" name="newPassword" id="newPassword" required>
                        </div> 
                        <div class="oneInput">
                            <label for="newConfirmedPassword">Confirm password <span>*</span></label>
                            <input type="text" placeholder="Password" name="newConfirmedPassword" id="newConfirmedPassword" required>
                        </div> 
                    </div>
                    <div class="submitBtnArea">
                        <button class="submitBtn">continue&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M4 12h16m0 0l-6-6m6 6l-6 6" />
                            </svg></button>
                    </div>
                </form>

            </div>

        </div>
    </div>

    <div class="alert" style="display: none;">
        <div class="alertBadge">
            <button onclick="document.querySelector('.alert').style.display = 'none'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"/><path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5"/></g></svg></button>
            <p>Alert data will be shown here. Alert data will be shown here.</p>
        </div>
    </div>


    <!-- JS FILES LINKS -->
    <script src="/js/global/pagePreloading.js"></script>

    <!-- <script>
        document.getElementById("newPasswordForm").addEventListener("submit", async function (e) {
            e.preventDefault();
    
            // Get user_id and email from localStorage
            const user_id = localStorage.getItem("user_id");
            const email = localStorage.getItem("email");
    
            if (!user_id || !email) {
                alert("User ID or Email not found. Please request a new reset link.");
                return;
            }
    
            const newPassword = document.getElementById("newPassword").value;
            const confirmPassword = document.getElementById("newConfirmedPassword").value;
    
            // Password validation
            if (newPassword !== confirmPassword) {
                alert("Passwords do not match!");
                return;
            }
    
            try {
                const response = await fetch("http://localhost:5000/usertrs/setnewpassword", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        user_id: user_id,
                        email: email,
                        password: newPassword
                    }),
                });
    
                const data = await response.json();
    
                if (data.status === "success") {
                    alert("Password updated successfully!");
    
                    // Optional: Clear localStorage after successful password reset
                    localStorage.removeItem("user_id");
                    localStorage.removeItem("email");
    
                    // Redirect to login page or another page
                    window.location.href = "http://127.0.0.1:5500/msm_kosmetika_fin/account.html";
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert("Error: " + error.message);
            }
        });









        window.addEventListener("load", async () => {
    console.log("Page loaded. Validating reset link...");

    // Extract user_id from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const user_id = urlParams.get("userid");
    console.log("Extracted user_id:", user_id);

    if (!user_id) {
        console.warn("Invalid reset link: User ID missing.");
        alert("Invalid reset link. User ID missing.");
        window.location.href = "login.html"; // Redirect to login if no user_id
        return;
    }

    try {
        console.log("Sending request to validate reset link...");

        const response = await fetch(`http://127.0.0.1:5000/usertrs/validate_reset_link?userid=${user_id}`, {
            method: "GET",
        });

        const data = await response.json();
        console.log("Validation response:", data);

        if (data.status === "success") {
            console.log("Reset link is valid. Proceeding...");

            // Store user_id and email in localStorage for the password reset
            localStorage.setItem("user_id", user_id);
            localStorage.setItem("email", data.response.email);

            // Continue with the password reset process (optional)
            alert("Reset link is valid. You can now reset your password.");
        } else {
            console.warn("Invalid or expired reset link.");
            alert("Invalid or expired reset link.");
            window.location.href = "login.html"; // Redirect if invalid
        }
    } catch (error) {
        console.error("Error during reset link validation:", error);
        alert("Error: " + error.message);
        window.location.href = "login.html";
    }
});

    </script>
     -->

    <script src="/js/apiscalling/logout.js"></script>
    <script src="/js/apiscalling/set-new-password.js"></script>
</body>

</html>